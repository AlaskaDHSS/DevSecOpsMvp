# Introduction 
This repository tracks assets of the minimum viable product for a DevOps continuous integration, continuous deployment pipeline for the [Alaska DHSS modernization project](https://github.com/18F/acq-alaska-dhss-modernization).  This project aims to transform the way Alaska approaches implementation and support activities for its mission critical technology products.  We plan to do this by taking deeper ownership of the product definition and the foundational processes and tools used in exchange for steeply reduced financial and functional risks of traditional, monolithic approaches.

## Definition of DevOps
We believe that DevOps capabilities must support and include:
1.  Rapid onboarding of vendors and other project contributors via pre-packaged development environment
2.  Consistent, prescribed development and continuous integration processes
3.  Measured, minimum standard code quality via automated and enforced unit test and code coverage standards
4.  Rapid feedback via automated, continuous delivery processes
5.  Modern change capabilities that meet the demands of the ever changing business and technology landscape 

### Rapid onboarding
Onboarding will be support via a combination of application and/or OS image virtualization using technologies like Azure Dev/Test Labs, Docker, and possibly other virtualization.  New contributors should be able to onboard with a standard development toolset without having to install tools, etc.  Development, integration, test and production environmental differences should be minimized.

### Conistent and Prescribed Development and Continuous Integration
Development and integration processes will be built on top of Visual Studio Team Services and Git.  These processes will leverage pull requests and continuous integration triggers to ensure that all code merged into the mainline is immediately built and passed or rejected.

### Measured, minimum standard code quality
Continuous integration build processes will automatically execute unit tests.  Code coverage by unit tests will be measured and minimum code coverage standards will be defined as an accept/reject criterion for build success or failure.

### Rapid feedback via Continuous delivery
Successful CI builds will be automatically deployed to Azure hosted test infrastructure [TBD: I'm inclined to address automated GUI testing, but it feels a little far off right now...]

### Modern change capabilities
We expect this definition of DevOps to evolve over time as we build the initial pipeline and then learn through the first several product increment acquisitions what works and what needs to improve.  The modern business delivery and technology landscape requires technology products that can rapidly adapt to changes in both business requirements and tools that support those requirements.  The core mission behind the DevOps approach must be to enable and demonstrate success with delivery rapid, high-quality change.


## Development environments
This is a DevOps MVP based around an example ASP.NET Core web app. The webapp was generated by `dotnet new mvc`.  Setup documented below for Windows(Local and Cloud), and Mac/OSX.

### Windows Local 
First install the [latest .NET Core SDK](https://www.microsoft.com/net/core#windowscmd) TODO: automate this upgrade

```ps1
cd aspnetapp
# rd obj #to remove cache
dotnet restore
dotnet run
```

your app is running on `http://localhost:5000`

Windows / virtualization notes:
- Virtualizaiton still seems young on the Windows platform.
- Windows does not support nested virtualization -- i.e. Docker running on Windows that is already under virtualization.
- Windows Docker containers like `windows/nanoserver` only run on Windows.
- Azure has some support for nested virtualization ("Server2016 with Containers", running on special hardware) but it seems buggy.
- ATM, docker-compose doesn't work on Server2016
- ATM, Server2016 has a bug that prevents connecting to Docker containers on localhost

### OSX Local
On OSX we use a Docker container to run our ASP.Net app.  [Make sure "Docker for Mac" is installed](https://docs.docker.com/docker-for-mac/install/#download-docker-for-mac)

```sh
docker build -f Dockerfile.mac -t aspnetapp .
docker run -p 5000:5000 aspnetapp
```

Your app is running on `http://localhost:5000`.  Note that your `Project.cs` must be listening on `http://*:5000/`. 

Debug container build:
```sh
docker ps
docker run -it <container-id> sh
```

### Azure DevTestLabs
After investigation, [Azure DevTestLabs](https://azure.microsoft.com/en-us/services/devtest-lab/) seem like a good product, we can:
- automate creation of DTL VMs with Windows or Linux
- automate provisioning of DTL VMs with things like git, VSCode, etc.
- automate shutdown of these VMs at the end of a workday to save money
- DTL VMs can be provisioned on "Server2016 with Containers" for potential future Dockering
- Users connect to DTL VMs via RDP
- There is VSTS/DTL integration that I didn't investigate

A rough estimate puts cost of this service at **$50/developer/month**.
Leaving DTL notes here. We are not using DTL right now -- it doesn't give us better virtualization and they cost money.