# DevOps Roadshow

This is a DevOps MVP based around an example ASP.NET Core web app. The webapp was generated by `dotnet new mvc`

Please clone this repo with **SSH Keys**, here are some [good instructions](https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/#platform-windows).


## Development environments
We use Docker for development environments. There are a couple gotchas:

### Windows Local 
First install the [latest .NET Core SDK](https://www.microsoft.com/net/core#windowscmd) TODO: automate this upgrade

```
cd aspnetapp
# rd obj #to remove cache
dotnet restore
dotnet run
```

The app is running at [http://localhost:5000](http://localhost:5000)

Windows / Docker notes:
- Virtualizaiton still seems young on the Windows platform.
- Windows does not support nested virtualization -- i.e. Docker running on Windows that is already under virtualization.
- Windows Docker containers like `windows/nanoserver` only run on Windows.
- Azure has some support for nested virtualization ("Server2016 with Containers", running on special hardware) but it seems buggy.
- ATM, docker-compose doesn't work on Server2016
- ATM, Server2016 has a bug that prevents connecting to Docker containers on localhost

### OSX Local

docker version
docker pull microsoft/nanoserver
docker images

Some DOCKERFILE that works
```
FROM microsoft/dotnet:nanoserver
COPY . c:/aspnetapp/
WORKDIR c:/aspnetapp
RUN dotnet restore
CMD dotnet run
```

# Does it run?
docker run -it microsoft/nanoserver cmd


start aspnet container
```
docker build -t aspnetapp .
docker run -p 5000:5000 aspnetapp
```


### Azure DevTestLabs

After investigation, [Azure DevTestLabs](https://azure.microsoft.com/en-us/services/devtest-lab/) seem like a good product, we can:
- automate creation of DTL VMs with Windows or Linux
- automate provisioning of DTL VMs with things like git, VSCode, etc.
- automate shutdown of these VMs at the end of a workday to save money
- DTL VMs can be provisioned on "Server2016 with Containers" for potential future Dockering
- Users connect to DTL VMs via RDP
- There is VSTS/DTL integration that I didn't investigate

Leaving DTL notes here. We are not using DTL right now -- it doesn't give us better virtualization and they cost money.